    <link rel="stylesheet" href="/static/css/historico.css">
    <link rel="stylesheet" href="/static/css/base.css">
{% extends "base_dashboard.html" %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/historico.css') }}">
{% endblock %}

{% block title %}Histórico{% endblock %}

{% block content %}
<section class="dashboard">
    <div class="container">
        <div class="dashboard-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="/dashboard"><i class="fas fa-home"></i> Início</a></li>
                    <li><a href="/doacao"><i class="fas fa-tshirt"></i> Fazer Doação</a></li>
                    <li class="active"><a href="/historico"><i class="fas fa-history"></i> Histórico</a></li>
                    
                    <li><a href="/ticket"><i class="fas fa-headset"></i> Suporte</a></li>
                    {% if session.role == 'admin' %}
                    <li><a href="/admin"><i class="fas fa-cog"></i> Administração</a></li>
                    {% endif %}
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <div class="content-header">
                    <h2 class="content-title">Histórico</h2>
                </div>
                
                {% if doacoes %}
                <div class="history-actions">
                    <button id="clearHistoryBtn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Limpar Histórico
                    </button>
                </div>
                {% endif %}
                
                {% if doacoes %}
                <div class="donation-history">
                    {% for doacao in doacoes %}
                    <div class="donation-card">
                        <div class="donation-header">
                            <span class="donation-id">Doação #{{ doacao.id }}</span>
                            <span class="donation-date">{{ doacao.data }}</span>
                            <span class="status-badge status-{{ doacao.status }}">{{ doacao.status|capitalize }}</span>
                        </div>
                        
                        <div class="donation-details">
                            <p><strong>Endereço:</strong> {{ doacao.endereco }}</p>
                            
                            <div class="donation-items">
                                <h4>Itens Doados:</h4>
                                <ul>
                                    {% if doacao.itens.items is defined %}
                                        {% for item, quantity in doacao.itens.items() %}
                                            {% if quantity|int > 0 %}
                                                <li>{{ quantity }}x {{ item|capitalize }}</li>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        {% for it in doacao.itens %}
                                            <li>{{ it.Quantidade }}x {{ it.Tipo|capitalize }}{% if it.Tamanho %} - Tamanho: {{ it.Tamanho }}{% endif %}{% if it.Categoria %} - {{ it.Categoria }}{% endif %}</li>
                                        {% endfor %}
                                    {% endif %}
                                </ul>
                            </div>
                            
                            {% if doacao.status == 'pendente' %}
                            <div class="donation-actions">
                                <form action="{{ url_for('cancelar_doacao', donation_id=doacao.id) }}" method="POST">
                                    <button type="submit" class="btn btn-danger">Cancelar Doação</button>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info">
                    <p>Você ainda não fez nenhuma doação.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Modal de Confirmação para Limpar Histórico -->
<div id="clearHistoryModal" class="modal-overlay" style="display:none;">
    <div class="modal-content modal-confirm">
        <div class="modal-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Limpar Histórico</h3>
            <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Tem certeza que deseja <strong>excluir todo o seu histórico de doações?</strong></p>
            <p style="color: #666; font-size: 0.95rem; margin-top: 10px;">Esta ação <strong>não pode ser desfeita</strong> e todos os registros serão permanentemente removidos.</p>
        </div>
        <div class="modal-footer">
            <button id="cancelBtn" class="btn btn-outline">Cancelar</button>
            <button id="confirmClearBtn" class="btn btn-danger">Excluir Tudo</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const clearHistoryModal = document.getElementById('clearHistoryModal');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmClearBtn = document.getElementById('confirmClearBtn');

    if (clearHistoryBtn) {
        clearHistoryBtn.addEventListener('click', function() {
            clearHistoryModal.style.display = 'flex';
        });
    }

    if (closeModal) {
        closeModal.addEventListener('click', function() {
            clearHistoryModal.style.display = 'none';
        });
    }

    if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
            clearHistoryModal.style.display = 'none';
        });
    }

    if (confirmClearBtn) {
        confirmClearBtn.addEventListener('click', function() {
            // Submeter para servidor usando rota de limpar direto
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("limpar_historico") }}';
            document.body.appendChild(form);
            form.submit();
        });
    }

    // Fechar modal ao clicar fora
    window.addEventListener('click', function(event) {
        if (event.target === clearHistoryModal) {
            clearHistoryModal.style.display = 'none';
        }
    });
});
</script>
{% endblock %}