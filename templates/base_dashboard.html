<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}REvest{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS Base do Dashboard -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base_dashboard.css') }}">

    <!-- CSS Global -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">

    <!-- CSS Específico da Página -->
    {% block page_css %}{% endblock %}

    <!-- Mobile-first overrides for dashboard (post-login) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile_dashboard.css') }}">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
</head>
<body>

    <!-- Header Simplificado para Dashboard -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo-container">
                    <a class="logo" href="/dashboard">
                        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="REvest Logo" style="height: 40px;">
                    </a>
                </div>
                <div class="auth-buttons">
                    <div class="account-menu-container">
                      <div class="account-menu-trigger" id="accountMenuTrigger">
                        <span class="account-icon">
                          <i class="fa fa-user" style="font-size: 22px;"></i>
                        </span>
                        <span class="account-name">{{ session.name[:8] }}{% if session.name|length > 8 %}...{% endif %}</span>
                      </div>
                      <div class="account-menu" id="accountMenu" style="display:none;">
                        <ul>
                          <li><a href="/conta/editar">Editar Conta</a></li>
                          <li><a href="/conta/senha">Mudar Senha</a></li>
                          <li><a href="/conta/endereco">Endereço</a></li>
                          <li><a href="/conta/suporte">Suporte</a></li>
                          <li><a href="/conta/deletar" style="color:var(--danger);">Deletar Conta</a></li>
                          <li><a href="/logout" style="color:var(--gray);">Sair</a></li>
                        </ul>
                      </div>
                    </div>
                </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Conteúdo principal -->
    {% block content %}
    {% endblock %}

    <!-- Footer Simplificado -->
    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>© 2025 REvest - Todos os direitos reservados</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

<!-- Navegação: proteção contra back/forward e botões laterais do mouse -->
<script>
(function () {
  try {
    history.pushState({preventBack: true}, document.title, location.href);
    window.addEventListener('popstate', function (e) {
      var el = document.getElementById('__nav_block_toast');
      if (window.__suppressNavToast) {
        window.__suppressNavToast = false;
        if (el) { el.dataset.suppress = 'false'; }
        return;
      }
      if (el && el.dataset && el.dataset.suppress === 'true') {
        el.dataset.suppress = 'false';
        return;
      }
      history.pushState({preventBack: true}, document.title, location.href);
      if (el) {
        el.style.display = 'block';
        clearTimeout(el.__t);
        el.__t = setTimeout(() => el.style.display = 'none', 1800);
      }
    });
    window.addEventListener('auxclick', function (e) {
      if (e.button === 3 || e.button === 4) {
        e.preventDefault();
        e.stopPropagation();
      }
    }, {passive: false});
    document.addEventListener('keydown', function (e) {
      if (e.altKey && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
        e.preventDefault();
        e.stopPropagation();
        return;
      }
      if (e.key === 'Backspace') {
        const el = document.activeElement;
        const tag = el && el.tagName ? el.tagName.toUpperCase() : '';
        const editable = el && (el.isContentEditable ||
                                tag === 'INPUT' || tag === 'TEXTAREA' ||
                                (el.getAttribute && el.getAttribute('role') === 'textbox'));
        if (!editable || el.readOnly || el.disabled) {
          e.preventDefault();
          e.stopPropagation();
        }
      }
    }, {passive: false});
    const toast = document.createElement('div');
    toast.id = '__nav_block_toast';
    toast.style.cssText = 'display:none;position:fixed;bottom:16px;left:50%;transform:translateX(-50%);padding:8px 12px;border-radius:6px;background:rgba(0,0,0,0.75);color:#fff;font-size:13px;z-index:99999';
    toast.textContent = 'Navegação por histórico desabilitada nesta página.';
    document.documentElement.appendChild(toast);
  } catch (err) {
    console.error('Nav-protection error:', err);
  }
})();
</script>

<!-- Mobile header compact toggler: add class to body when viewport is small -->
<script>
  (function () {
    function applyCompactHeader() {
      try {
        var w = window.innerWidth || document.documentElement.clientWidth;
        var h = window.innerHeight || document.documentElement.clientHeight;
        var isLandscape = w > h;
        // If landscape: use height threshold (<=420). If portrait: use width threshold (<=420).
        var isMobileSize = isLandscape ? (h <= 420) : (w <= 420);
        if (isMobileSize) document.body.classList.add('mobile-header-compact');
        else document.body.classList.remove('mobile-header-compact');

        /* JS fallback: apply inline styles to account menu trigger when mobile compact
           This ensures the position is applied even if other CSS rules with !important
           override external styles. We set style attribute directly (including !important)
           and remove it when not in mobile mode. */
        try {
          var accCont = document.querySelector('.account-menu-container') || document.querySelector('.account-menu-trigger');
          if (accCont) {
            if (isMobileSize) {
              // apply inline style with !important to guarantee precedence
              // descend 38px (30 + 8) to satisfy the latest request
              accCont.setAttribute('style', 'position: absolute; right: 35px !important; left: auto !important; top: 50% !important; transform: translateY(-50%) translateY(38px) !important; z-index: 1001 !important;');
            } else {
              // remove inline styles we applied so desktop styles take over
              // remove only if it contains the mobile fallback we applied to avoid clobbering other inline styles
              var current = accCont.getAttribute('style') || '';
              if (current.indexOf('right: 35px') !== -1 && current.indexOf('translateY(38px)') !== -1) {
                accCont.removeAttribute('style');
              }
            }
          }
        } catch (e) {
          console.error('account fallback positioning error', e);
        }
      } catch (err) {
        console.error('applyCompactHeader error', err);
      }
    }

    // Run on load, resize and orientation change (debounced on resize)
    window.addEventListener('load', applyCompactHeader);
    var __compactResizeT = null;
    window.addEventListener('resize', function () {
      clearTimeout(__compactResizeT);
      __compactResizeT = setTimeout(applyCompactHeader, 120);
    });
    window.addEventListener('orientationchange', applyCompactHeader);
  })();
</script>

</body>
</html>