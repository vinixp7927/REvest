    <link rel="stylesheet" href="/static/css/moderacao.css">
    <link rel="stylesheet" href="/static/css/base.css">
{% extends "base_dashboard.html" %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/moderacao.css') }}">
{% endblock %}

{% block title %}Moderação - REvest{% endblock %}

{% block content %}
<section class="dashboard">
    <div class="container">
        <div class="dashboard-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="/dashboard"><i class="fas fa-home"></i> Início</a></li>
                    <li><a href="/admin"><i class="fas fa-cog"></i> Administração</a></li>
                    <li><a href="/moderacao" class="active"><i class="fas fa-shield-alt"></i> Moderação</a></li>
                    <li><a href="/admin/aprovacoes"><i class="fas fa-check-double"></i> Aprovações</a></li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <div class="content-header">
                    <h2 class="content-title">Painel de Moderação</h2>
                    <div class="header-actions">
                        <a href="/moderacao?view=all" class="btn btn-outline">Todos os Usuários</a>
                        <a href="/moderacao?view=banned" class="btn btn-outline">Usuários Banidos</a>
                        <a href="/moderacao?view=muted" class="btn btn-outline">Usuários Silenciados</a>
                    </div>
                </div>

                <!-- Barra de Pesquisa -->
                <div class="search-box">
                    <form method="GET" action="/moderacao" class="search-form">
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" class="form-control" name="search" placeholder="Pesquisar por nome ou email..." value="{{ search_query }}">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i> Pesquisar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Estatísticas -->
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number">{{ total_users }}</div>
                        <div class="stat-title">Total de Usuários</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ banned_users }}</div>
                        <div class="stat-title">Usuários Banidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ muted_users }}</div>
                        <div class="stat-title">Usuários Silenciados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ coletor_users }}</div>
                        <div class="stat-title">Coletores</div>
                    </div>
                </div>

                <!-- Lista de Usuários -->
                <div class="users-list">
                    <h3>Lista de Usuários</h3>
                    
                    {% if users %}
                    <div class="table-responsive">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>CPF</th>
                                    <th>Cargo</th>
                                    <th>Data Cadastro</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr class="user-row {% if user.is_banned %}banned{% endif %} {% if user.is_muted %}muted{% endif %}">
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.name }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.CPF }}</td>
                                    <td>
                                        <span class="role-badge role-{{ user.role }}">{{ user.role|capitalize }}</span>
                                    </td>
                                    <td>{{ user.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                                    <td>
                                        {% if user.is_banned %}
                                        <span class="status-badge status-banned">Banido</span>
                                        {% elif user.is_muted %}
                                        <span class="status-badge status-muted">Silenciado</span>
                                        {% else %}
                                        <span class="status-badge status-active">Ativo</span>
                                        {% endif %}
                                    </td>
                                    <td class="actions-cell">
                                        <div class="action-buttons">
                                            <!-- Promover/Demover -->
                                            {% if user.role == 'user' %}
                                            <button class="btn btn-sm btn-success btn-promote" data-user-id="{{ user.id }}" data-role="coletor">
                                                <i class="fas fa-user-plus"></i> Coletor
                                            </button>
                                            <button class="btn btn-sm btn-primary btn-promote" data-user-id="{{ user.id }}" data-role="admin">
                                                <i class="fas fa-star"></i> Admin
                                            </button>
                                            {% elif user.role == 'coletor' %}
                                            <button class="btn btn-sm btn-warning btn-promote" data-user-id="{{ user.id }}" data-role="user">
                                                <i class="fas fa-user-minus"></i> Usuário
                                            </button>
                                            <button class="btn btn-sm btn-primary btn-promote" data-user-id="{{ user.id }}" data-role="admin">
                                                <i class="fas fa-star"></i> Admin
                                            </button>
                                            {% elif user.role == 'admin' and user.email != 'revest@gmail.com' %}
                                            <button class="btn btn-sm btn-warning btn-promote" data-user-id="{{ user.id }}" data-role="user">
                                                <i class="fas fa-user-minus"></i> Usuário
                                            </button>
                                            {% endif %}

                                            <!-- Banir/Desbanir -->
                                            {% if not user.is_banned and user.email != 'revest@gmail.com' %}
                                            <button class="btn btn-sm btn-danger btn-ban" data-user-id="{{ user.id }}">
                                                <i class="fas fa-ban"></i> Banir
                                            </button>
                                            {% elif user.is_banned %}
                                            <button class="btn btn-sm btn-success btn-unban" data-user-id="{{ user.id }}">
                                                <i class="fas fa-check"></i> Desbanir
                                            </button>
                                            {% endif %}

                                            <!-- Silenciar/Dessilenciar -->
                                            {% if not user.is_muted and user.email != 'revest@gmail.com' %}
                                            <button class="btn btn-sm btn-warning btn-mute" data-user-id="{{ user.id }}">
                                                <i class="fas fa-volume-mute"></i> Silenciar
                                            </button>
                                            {% elif user.is_muted %}
                                            <button class="btn btn-sm btn-info btn-unmute" data-user-id="{{ user.id }}">
                                                <i class="fas fa-volume-up"></i> Dessilenciar
                                            </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <p>Nenhum usuário encontrado.</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Modal para Banir -->
                <div id="banModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>Banir Usuário</h3>
                        <form id="banForm" method="POST" action="/moderacao/banir">
                            <input type="hidden" name="user_id" id="banUserId">
                            <div class="form-group">
                                <label for="banReason">Motivo do Banimento:</label>
                                <textarea class="form-control" id="banReason" name="ban_reason" rows="3" placeholder="Digite o motivo do banimento..." required></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-danger">Confirmar Banimento</button>
                                <button type="button" class="btn btn-outline close-modal">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ...existing code...

    // Promover usuário
    document.querySelectorAll('.btn-promote').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const newRole = this.getAttribute('data-role');
            
            if (confirm(`Tem certeza que deseja promover este usuário para ${newRole}?`)) {
                fetch('/moderacao/promover', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        new_role: newRole
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Usuário promovido com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro ao promover usuário: ' + data.error);
                    }
                });
            }
        });
    });

    // Banir usuário
    document.querySelectorAll('.btn-ban').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            document.getElementById('banUserId').value = userId;
            document.getElementById('banModal').style.display = 'flex';
        });
    });

    // Desbanir usuário
    document.querySelectorAll('.btn-unban').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            
            if (confirm('Tem certeza que deseja desbanir este usuário?')) {
                fetch('/moderacao/desbanir', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Usuário desbanido com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro ao desbanir usuário: ' + data.error);
                    }
                });
            }
        });
    });

    // Silenciar usuário
    document.querySelectorAll('.btn-mute').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            
            if (confirm('Tem certeza que deseja silenciar este usuário? Ele não poderá fazer doações ou enviar tickets.')) {
                fetch('/moderacao/silenciar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Usuário silenciado com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro ao silenciar usuário: ' + data.error);
                    }
                });
            }
        });
    });

    // Dessilenciar usuário
    document.querySelectorAll('.btn-unmute').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            
            if (confirm('Tem certeza que deseja dessilenciar este usuário?')) {
                fetch('/moderacao/dessilenciar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Usuário dessilenciado com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro ao dessilenciar usuário: ' + data.error);
                    }
                });
            }
        });
    });

    // Modal functions
    const modal = document.getElementById('banModal');
    const closeButtons = document.querySelectorAll('.close-modal');

    closeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
    });

    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});
</script>
{% endblock %}